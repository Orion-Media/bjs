Object.defineProperty(Object.prototype,'getProperty',{value:function(c){if(c==='')return this;let i,d=this,e=c.toString().split('.'),f=e.length;for(i=0;i<f;i++){if(d[e[i]]!==void 0)d=d[e[i]];else return void 0}return d}});Object.defineProperty(Object.prototype,'setProperty',{value:function(c,d){let i,e=this,f=c.toString().split('.'),g=f.length;for(i=0;i<g-1;i++){if(e[f[i]]===void 0)e[f[i]]={};e=e[f[i]]}e[f[g-1]]=d}});'use strict';var bjs=selector=>new bjs.Selector(selector);bjs.strings=[];bjs.expressions=[];bjs.models=[];bjs.filters={empty:params=>params[0]===void 0||params[0]===null?params[1]?params[1]:'':params[2]?params[2]:'',if:c=>{var d=parseFloat(c[0]);if(!isNaN(d))c[0]=d;return c[0]?c[1]?c[1]:'':c[2]?c[2]:''},min:c=>{if(c[0]===void 0||c[0]===null)return'';return c[0].sort()[0]},max:c=>{if(c[0]===void 0||c[0]===null)return'';return c[0].sort().reverse()[0]}};bjs.__proto__.getModel=function(c){for(var i in this.models){if(this.models[i].selector.contains(c))return this.models[i]}};bjs.__proto__.getStringIndex=c=>{var d=bjs.strings.indexOf(c);if(d===-1){bjs.strings.push(c);d=bjs.strings.indexOf(c)}return d};bjs.__proto__.observe=c=>{var d,e,f,i,j;for(i in c){d=c[i];for(j=0;j<d.removedNodes.length;j++){e=d.removedNodes[j];f=e.b_model||bjs.getModel(e);if(f)f.unlink(e)}}};if(typeof b=='undefined')var b=bjs;if(typeof $=='undefined')var $=bjs;var observer=new MutationObserver(bjs.observe);observer.observe(document,{attributes:!0,attributeOldValue:!0,childList:!0,characterData:!0,characterDataOldValue:!0,subtree:!0});bjs.Model=class Model{constructor(c,d){if(d)d.strings=bjs.strings;bjs.models.push(this);this.proxyHandler=new bjs.ModelProxyHandler(this);this.shadow=d||{strings:bjs.strings};this.data=new Proxy({$:''},this.proxyHandler);this.links={};this.selector=new bjs.Selector(c);this.init()}get(c){return this.data.getProperty(c)}set(c,d){this.data.setProperty(c,d)}init(){let i,c;for(i in this.selector){c=this.selector.get(i);c.addEventListener('change',bjs.Model.eventHander,!0);c.addEventListener('keyup',bjs.Model.eventHander,!0);this.parse_node(c)}}apply_attributes(c){if(c.b_attributes===void 0)return;if(c instanceof Text){c.nodeValue=c.b_attributes.eval(this);return}for(let i in c.b_attributes)c.setAttribute(i,c.b_attributes[i].eval(this))}get_elements(c){let d=new Set;while(c!=''){if(this.links[c]!==void 0)this.links[c].forEach(e=>{d.add(e)});c=c.split('.').slice(0,-1).join('.')}return d}parse_attributes(c){if(c instanceof Text){if(c.nodeValue.indexOf('{{')!==-1){c.b_attributes=new bjs.Expression(c.nodeValue);let i,g=c.b_attributes.getLinks();for(i in g)this.link(c,g[i]);this.apply_attributes(c)}return}let i,d,e,f=c.attributes;for(i=0;i<f.length;i++){e=f[i];if(e.value.indexOf('{{')!==-1){if(c.b_attributes===void 0)c.b_attributes={};c.b_attributes[e.name]=new bjs.Expression(e.value);d=c.b_attributes[e.name].getLinks();for(let i in d)this.link(c,d[i]);this.apply_attributes(c)}}}parse_node(c,d){if(d)this.apply_attributes(c,d);else this.parse_attributes(c);if(c instanceof Text)return;if(c.hasAttribute('b-for'))this.parse_for(c,d);if(c.hasAttribute('b-base'))this.parse_base(c,d);let i,e,f=c.childNodes;for(i=0;i<f.length;i++){e=f[i];if(e instanceof Comment||e instanceof HTMLBRElement||e instanceof HTMLScriptElement)continue;this.parse_node(e)}if(c.hasAttribute('b-model'))this.parse_model(c)}parse_for(c,d){let e,f,g,h,k,l;if(c.b_template===void 0){c.b_template=c.children[0];c.b_template.remove()}e=c.getAttribute('b-for');this.link(c,e);g=c.getAttribute('b-as')||'_';f=c.getAttribute('b-key');h=this.data.getProperty(e);for(let i in h){k=h[i][f];if(d&&d!=e&&!d.startsWith(e+'.'+k))continue;l=c.querySelector('[b-base="'+e+'.'+k+'"]');if(!l){l=c.b_template.cloneNode(!0);l.b_for=e+'.'+k;l.b_key=k;l.setAttribute('b-base',l.b_for);this.replace_local(l,g,l.b_for);c.appendChild(l)}if(d)this.parse_base(l,d)}if(d&&d===e){for(let i=0;i<c.children.length;i++){l=c.children[i];f=l.b_key||'';if(h===void 0||h[f]===void 0&&l.b_for!==void 0&&l.b_for===e+'.'+f)l.remove()}}}parse_base(c,d){let e,f,g,h,l,m,n;e=h=c.getAttribute('b-base');this.link(c,h);g=c.getAttribute('b-key');if(g!==null){this.link(c,g);l=this.get(g);if(l!==void 0&&this.get(h+'.'+l)!==void 0)h+='.'+l;else h=''}h+='.';m=Array.prototype.slice.call(c.querySelectorAll('[b-field]'));if(c.hasAttribute('b-field'))m.push(c);for(let i in m){n=m[i];if(h!=='.'){l=h+n.getAttribute('b-field');if(d&&!l.startsWith(d)&&d!==g)continue;let o;if(n.getAttribute('b-model')!==l){o=n.getAttribute('b-model');n.setAttribute('b-model',l)}if(d)this.parse_model(n,o)}else{n.removeAttribute('b-model');this.parse_model(n)}}}parse_model(c,d){let e='',f=c.getAttribute('b-model');if(f!==null){if(d!==void 0)this.unlink(c,d);e=this.data.getProperty(f);if(e===void 0)e='';this.link(c,f)}else this.unlink(c);if(c instanceof HTMLInputElement||c instanceof HTMLButtonElement||c instanceof HTMLTextAreaElement||c instanceof HTMLSelectElement){if(typeof e!='object'&&c.value!=e)c.value=e}else{e=typeof e!='object'?e.toString():JSON.stringify(e);if(c.textContent!=e)c.textContent=e}}link(c,d){if(this.links[d]===void 0)this.links[d]=new Set;this.links[d].add(c);if(c.b_links===void 0)c.b_links=new Set;c.b_links.add(d);if(c.b_model!==this)c.b_model=this}unlink(c,d){if(d===void 0){if(c.b_model!==void 0&&c.b_links!==void 0)c.b_links.forEach(f=>{c.b_model.unlink(c,f)});let i,e=c.childNodes;for(i=0;i<e.length;i++)this.unlink(e[i])}else{if(this.links[d]!==void 0){this.links[d].delete(c);if(this.links[d].size===0)delete this.links[d]}if(c.b_links!==void 0){c.b_links.delete(d);if(c.b_links.size===0){delete c.b_model}}}}replace_local(c,d,e){let f=new RegExp('({{.*?)'+d.replace('.','.'),'gim');if(c instanceof Text){if(c.nodeValue.match(f))c.nodeValue=c.nodeValue.replace(f,'$1'+e);return}let i,g,h,k,l=c.attributes;for(i=0;i<l.length;i++){k=l[i];if(k.value.match(f))c.setAttribute(k.name,k.value.replace(f,'$1'+e))}g=c.childNodes;for(i=0;i<g.length;i++){h=g[i];if(h instanceof Comment||h instanceof HTMLBRElement||h instanceof HTMLScriptElement)continue;this.replace_local(h,d,e)}}};bjs.Model.eventHander=c=>{if(!(c.target instanceof HTMLInputElement)&&!(c.target instanceof HTMLButtonElement)&&!(c.target instanceof HTMLTextAreaElement)&&!(c.target instanceof HTMLSelectElement))return;let d=c.target.b_model,e=c.target.getAttribute('b-model');if(d===void 0||e===null)return;let f=d.get(e),g=c.target.value;if(f===g)return;d.set(e,g)};bjs.App=class App extends bjs.Model{constructor(c,d){return super(c,d)}};bjs.Expression=class Expression{constructor(c){bjs.expressions.push(this);this.tree=this.parse(c.trim())}eval(c,d){if(d===void 0)d=this.tree;let e,f,g,h=typeof d;switch(h){case'string':e=c.get(d);break;case'number':e=d;break;default:switch(d.type){case'+':case'-':case'*':case'/':for(let i in d.params){f=this.eval(c,d.params[i]);if((e===void 0||typeof e=='number')&&typeof f!='number'){g=parseFloat(f);if(!isNaN(g))f=g}if(e===void 0){e=f;continue}e=bjs.Expression.operations[d.type].func(e,f)}break;case'value':e=this.eval(c,d.params[0]);break;case'property':e=this.eval(c,d.params[0]);e=e!==void 0?e.getProperty(d.params[1]):void 0;break;case'index':e=c.get(d.params[0]+'.'+this.eval(c,d.params[1]));break;case'filter':let params=[];for(let i in d.params)params.push(this.eval(c,d.params[i]));e=bjs.filters[d.name](params);break;}}return e}getLinks(c){if(c===void 0)c=this.tree;let d,e,f=[];for(let i in c.params){d=c.params[i];e=typeof d;switch(e){case'number':break;case'string':if(d.endsWith('.length')){f.push(d.substr(0,d.length-7));continue}if(d.endsWith('.keys')){f.push(d.substr(0,d.length-5));continue}f.push(d);break;default:f.push.apply(f,this.getLinks(d));}}return f}parse(c){c=this.parse_unclosed(c);c=this.parse_strings(c);c=this.parse_tokens(c);return this.parse_tree(c)}parse_unclosed(c){let d=0,e='',f,g,h=/{{.*?}}/gm,k=/[-+*/[\]()|:]/gm;g=h.exec(c);while(g){if(g.index!==d){f=c.substr(d,g.index-d);e+='strings.'+bjs.getStringIndex(f)+' + ';d=g.index}f=g[0].substr(2,g[0].length-4).trim();if(k.test(f))f='('+f+')';e+=f+' + ';d+=g[0].length;g=h.exec(c)}f=c.substr(d).trim();if(f.length)e+='strings.'+bjs.getStringIndex(f);if(e.endsWith(' + '))e=e.substr(0,e.length-3);if(e.startsWith('(')&&e.endsWith(')'))e=e.substr(1,e.length-2);return e}parse_strings(c){let d='',e=0,f={start:0},g=/['"]/gm,h=g.exec(c);while(h){if(!f.start){f.start=h.index+1;f.delim=h[0];d+=c.substr(e,h.index-e)}else{if(f.delim===h[0]){f.string=c.substr(f.start,h.index-f.start);f.index=bjs.getStringIndex(f.string);d+='strings.'+f.index;f.start=0}}e=h.index+1;h=g.exec(c)}if(e<c.length)d+=c.substr(e).trim();return d}parse_tokens(c){let d=0,e,f,g=/[-+*/[\]()|:]/gm,h=[];d=0;g.lastIndex=0;f=g.exec(c);while(f){if(f.index!==d){e=c.substr(d,f.index-d).trim();if(e.length){h.push(c.substr(d,f.index-d).trim())}d=f.index}h.push(f[0].trim());d+=f[0].length;f=g.exec(c)}e=c.substr(d).trim();if(e.length)h.push(e);return h}parse_tree(c,d){if(d===void 0)d={};if(d.params===void 0)d.params=[];let e,f;while(c.length){e=c.shift();switch(e){case'-':case'+':case'*':case'/':if(d.type===void 0){d.type=e;continue}if(d.type===e){if(bjs.Expression.operations[d.type].priority>bjs.Expression.operations[e].priority)d={type:e,params:[d]};if(bjs.Expression.operations[d.type].priority<bjs.Expression.operations[e].priority)d.params.push(this.parse_tree(c,{type:e,params:[d.params.pop()]}))}else{d.params.push(this.parse_tree(c,{type:e,params:[d.params.pop()]}))}break;case'(':d.params.push(this.parse_tree(c));break;case')':return d;break;case'[':d.params.push({type:'index',params:[d.params.pop(),this.parse_tree(c)]});break;case']':if(d.type===void 0)d.type='value';return d;break;case'|':if(d.type!==void 0)d={params:[d]};d.type='filter';d.name=c.shift();e=c.shift();while(e===':'){d.params.push(this.parse_tree(c));e=c.shift()}c.unshift(e);return d;break;case':':c.unshift(e);if(!d.params.length)return'';if(d.type===void 0)d.type='value';return d;break;default:if(e[0]=='.'){e=e.substr(1);if(d.type===void 0){d.type='property';d.params.push(e)}else d.params.push({type:'property',params:[d.params.pop(),e]})}else{f=parseFloat(e);if(!isNaN(f))e=f;d.params.push(e)}}}if(d.type===void 0)d.type='value';return d}};bjs.Expression.operations={"+":{priority:0,func:(a,b)=>a+b},"-":{priority:0,func:(a,b)=>a-b},"*":{priority:1,func:(a,b)=>a*b},"/":{priority:1,func:(a,b)=>a/b}};bjs.ModelProxyHandler=class ModelProxyHandler{constructor(c){this.model=c}deleteProperty(c,d){let e=this.model.shadow.getProperty(c.$);delete e[d];let f=(c.$?c.$+'.':'')+d,g=this.model.get_elements(f),h=this.model;g.forEach(k=>{if(k.b_for!==void 0&&k.b_for===f){k.remove();return}h.parse_node(k,f)});return!0}enumerate(c){let d=this.model.shadow.getProperty(c.$);return Object.keys(d)[Symbol.iterator]()}get(c,d){if(d==='constructor')return{name:'Proxy'};let e=this.model.shadow.getProperty(c.$);switch(d){case'keys':return Object.keys(e);break;case'length':return Object.keys(e).length;break;case'toJSON':return()=>e;break;}if(e[d]===void 0)return;if(e[d]!==null&&typeof e[d]=='object')return new Proxy({$:(c.$?c.$+'.':'')+d},this.model.proxyHandler);return e[d]}getPrototypeOf(c){let d=this.model.shadow.getProperty(c.$);return d}has(c,d){let e=this.model.shadow.getProperty(c.$);return Reflect.has(e,d)}isExtensible(c){let d=this.model.shadow.getProperty(c.$);return Reflect.isExtensible(d)}ownKeys(c){let d=this.model.shadow.getProperty(c.$);return Reflect.ownKeys(d)}set(c,d,e){let f=this.model.shadow.getProperty(c.$);if(f[d]!==e){f[d]=e;let g=(c.$?c.$+'.':'')+d,h=this.model.get_elements(g),k=this.model;h.forEach(l=>{k.parse_node(l,g)})}return!0}};bjs.Selector=class Selector extends Array{constructor(c,d){super();if(c!==void 0){switch(c.constructor.name){case'String':if(c.length>0)bjs.Selector.prototype.push.apply(this,document.querySelectorAll(c));break;case'Array':bjs.Selector.prototype.push.apply(this,c);break;default:if(c instanceof HTMLElement)this.push(c);}}Object.defineProperty(this,'selector',{enumerable:!1,writable:!0});this.selector=d}addClass(c){return this.classes('add',c)}attr(c,d){return this.forEach({action:'attr',name:c,value:d})}contains(c){return this.forEach({action:'contains',node:c})}end(){return this.selector}find(c){return this.forEach({action:'find',selector:c})}get(c){return this[c]}hasClass(c,d){return this.forEach({action:'hasClass',class:c,all:d})}html(c){return this.forEach({action:'html',value:c})}is(c,d){return this.forEach({action:'is',selector:c,all:d})}parent(){return this.forEach({action:'parent'})}removeClass(c){return this.classes('remove',c)}text(c){return this.forEach({action:'text',value:c})}toggleClass(c,d){return this.classes('toggle',c)}val(c){return this.forEach({action:'val',value:c})}classes(c,d,e){if(typeof d=='string')d=d.split(' ');for(let i in this){for(let j in d){if(c==='toggle'){this[i].classList.toggle(d[j],e)}else{this[i].classList[c](d[j])}}}return this}forEach(c){if(c.value!==void 0){for(let i in this){switch(c.action){case'attr':this[i].setAttribute(c.name,c.value);break;case'html':this[i].innerHTML=c.value;break;case'text':this[i].textContent=c.value;break;case'val':if(this[i]instanceof HTMLInputElement)this[i].value=c.value;break;}}return this}if(this.length===0)return void 0;let i,d,e=[];for(i in this){switch(c.action){case'attr':d=this[i].getAttribute(c.name);e.push(d!==null?d:void 0);break;case'contains':if(this[i]===c.node||this[i].contains(c.node))return!0;break;case'find':Array.prototype.push.apply(e,this[i].querySelectorAll(c.selector));break;case'html':e.push(this[i].innerHTML);break;case'hasClass':d=this[i].classList.contains(c.class);if(c.all!==!0){if(d)return!0}else{if(!d)return!1}break;case'is':d=this[i].matches(c.selector);if(c.all!==!0){if(d)return!0}else{if(!d)return!1}break;case'parent':e.push(this[i].parentNode);break;case'text':e.push(this[i].textContent);break;case'val':e.push(this[i]instanceof HTMLInputElement?this[i].value:void 0);break;}}switch(c.action){case'contains':return!1;case'find':case'parent':return new bjs.Selector(e,this);case'hasClass':case'is':return c.all===!0?!0:!1;default:return e.length>1?e:e[0];}}};